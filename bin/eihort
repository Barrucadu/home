#!/bin/zsh

mhd=true
m2hd=false
archos5=false
media=true
share=true
torrents=true
www=true
up=true
pacsync=true

function parsearg()
{
    case $1 in
        "nomhd")
            mhd=false;;
        "m2hd")
            m2hd=true;;
        "archos5")
            archos5=true;;
        "nomedia")
            mhd=false
            m2hd=false
            archos5=false
            media=false;;
        "nopacsync")
            pacsync=false;;
        "noshare")
            pacsync=false
            share=false;;
        "notorrents")
            torrents=false;;
        "nowww")
            www=false;;
        "down")
            up=false;;
    esac
}

function emount ()
{
    rmdir /media/$1
    ln -s /share/eihort-media/$1 /media/$1
}

function eumount ()
{
    rm /media/$1
    mkdir /media/$1
    chmod 777 /media/$1
}


for arg in "${*[@]}"; do
    parsearg $arg
done

if $up; then
    $mhd     && emount MHD
    $m2hd    && emount M2HD
    $archos5 && emount ARCHOS5

    $share    && mount -t cifs -o username=share,password=share //eihort/share    /share/eihort
    $media    && mount -t cifs -o username=share,password=share //eihort/media    /share/eihort-media
    $torrents && mount -t cifs -o username=share,password=share //eihort/torrents /share/eihort-torrents
    $www      && mount -t cifs -o username=share,password=share //eihort/www      /share/eihort-www

    $pacsync && /etc/cron.weekly/packagecache.sh
else
    $pacsync && /etc/cron.weekly/packagecache.sh

    $share    && umount /share/eihort
    $media    && umount /share/eihort-media
    $torrents && umount /share/eihort-torrents
    $www      && umount /share/eihort-www

    $mhd     && eumount MHD
    $m2hd    && eumount M2HD
    $archos5 && eumount ARCHOS5
fi
