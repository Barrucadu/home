#!/bin/zsh

HOST=eihort
PORT=22

media=true
share=true
http=true
sudocmd=sudo

[[ "$UID" == "0" ]] && sudocmd=''

function parsearg()
{
    case $1 in
        "nomedia")
            media=false;;
        "noshare")
            share=false;;
        "nohttp")
            http=false;;
    esac
}

function eimount ()
{
    sshfs barrucadu@$HOST:/srv/$1 /share/$2 -C -p $PORT
    #$sudocmd mount -t nfs4 $HOST:/$1 /share/$2
}

function eiumount ()
{
    fusermount -u /share/$1
    #$sudocmd umount /share/$1
}

for arg in "${*[@]}"; do
    parsearg $arg
done

if ! mount | grep -q eihort; then
    $share    && eimount share    eihort
    $media    && eimount media    eihort-media
    $http     && eimount http     eihort-http
else
    $share    && eiumount eihort
    $media    && eiumount eihort-media
    $http     && eiumount eihort-http
fi
