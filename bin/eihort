#!/bin/zsh

media=true
share=true
torrents=true
http=true
sshfs=false

function parsearg()
{
    case $1 in
        "nomedia")
            media=false;;
        "noshare")
            share=false;;
        "notorrents")
            torrents=false;;
        "nohttp")
            http=false;;
        "sshfs")
            sshfs=true;;
    esac
}

function eimounted ()
{
    mount | grep -q //eihort/$1
}

function eimount ()
{
    $1 && \
	sshfs barrucadu@network.barrucadu.co.uk:/srv/$2 /share/$3 -C -p 2222 || \
	mount -t cifs -o username=share,password=share //eihort/$2 /share/$3
}

function eiumount ()
{
    $1 && \
	fusermount -u /share/$2 || \
	umount /share/$2
}

for arg in "${*[@]}"; do
    parsearg $arg
done

if ping -c1 eihort &>/dev/null; then
    if ! mount | grep -q eihort; then
	$share    && eimount $sshfs share    eihort
	$media    && eimount $sshfs media    eihort-media
	$torrents && eimount $sshfs torrents eihort-torrents
	$http     && eimount $sshfs http     eihort-http
    else
	$share    && eiumount $sshfs eihort
	$media    && eiumount $sshfs eihort-media
	$torrents && eiumount $sshfs eihort-torrents
	$http     && eiumount $sshfs eihort-http
    fi
else
    echo "Eihort not found."
    return 2
fi