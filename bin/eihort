#!/bin/zsh

media=true
share=true
torrents=true
http=true
remote=false

function parsearg()
{
    case $1 in
        "nomedia")
            media=false;;
        "noshare")
            share=false;;
        "notorrents")
            torrents=false;;
        "nohttp")
            http=false;;
        "remove")
            remove=true;;
    esac
}

$remote && host='network.barrucadu.co.uk' || host='eihort'
$remote && port=2222 || port=22

function eimounted ()
{
    mount | grep -q //eihort/$1
}

function eimount ()
{
    sshfs barrucadu@$host:/srv/$1 /share/$2 -C -p $port
}

function eiumount ()
{
    fusermount -u /share/$1
}

for arg in "${*[@]}"; do
    parsearg $arg
done

if ! mount | grep -q $host; then
    $share    && eimount share    eihort
    $media    && eimount media    eihort-media
    $torrents && eimount torrents eihort-torrents
    $http     && eimount http     eihort-http
else
    $share    && eiumount eihort
    $media    && eiumount eihort-media
    $torrents && eiumount eihort-torrents
    $http     && eiumount eihort-http
fi
