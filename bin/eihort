#!/bin/zsh

HOST=eihort
PORT=22

media=true
share=true
http=true
nfs=false

[[ "$UID" == "0" ]] && sudocmd=''

function parsearg()
{
    case $1 in
        "nomedia")
            media=false;;
        "noshare")
            share=false;;
        "nohttp")
            http=false;;
        "nfs")
            nfs=true;;
    esac
}

function eimount ()
{
    if $nfs; then
        sudo mount -t nfs4 $HOST:/$1 /share/$2
    else
        sshfs barrucadu@$HOST:/srv/$1 /share/$2 -C -p $PORT
    fi
}

function eiumount ()
{
    if $nfs; then
        sudo umount /share/$1
    else
        fusermount -u /share/$1
    fi
}

for arg in "${*[@]}"; do
    parsearg $arg
done

if ! mount | grep -q eihort; then
    $share    && eimount share    eihort
    $media    && eimount media    eihort-media
    $http     && eimount http     eihort-http
else
    nfs=`mount | grep eihort | grep -q nfs`

    $share    && eiumount eihort
    $media    && eiumount eihort-media
    $http     && eiumount eihort-http
fi
