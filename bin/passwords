#!/bin/zsh

pwfile=`default $PASSWORDFILE ~/passwords.asc`
gpgkey=`default $PASSWORDKEY 9F58FC68`
e=`default $EDITOR emacs`

tmpfile=~/tmp/passwords

if [[ ! -f $pwfile ]]; then
    echo "$pwfile is not a file."
    exit 1;
fi

action=`default $1 "list"`

case $action in
    "list")
        gpg -d $pwfile
        ;;

    "get")
        gpg -d $pwfile | grep $2
        ;;

    "edit")
        gpg -d $pwfile > $tmpfile
        $e $tmpfile
        gpg -e -r $gpgkey -a $tmpfile
        mv $tmpfile.asc $pwfile
        rm $tmpfile
        ;;

    *)
        echo "USAGE: passwords (list | grep <param> | edit)"
        exit 1
        ;;
esac
