#!/bin/zsh

i=1

[ -f index.html ] && rm index.html &>/dev/null

while [[ "$i" != "637" ]]; do
    if [[ "$i" != "404" ]]; then
        if [[ -f "$i.jpg" ]] || [[ -f "$i.png" ]]; then
            wget "http://www.xkcd.com/$i" &>/dev/null
            filename=`cat index.html | grep "img src.*comics" | sed "s/\(.*src=\"\|\".*\)//g" | sed "s/.*\///g"`
            rm index.html &>/dev/null
            [ -f "$i.jpg" ] \
                && mv -v "$i.jpg" "$i-$filename" \
                || mv -v "$i.png" "$i-$filename"
        fi
    fi
    i=$[$i + 1]
done