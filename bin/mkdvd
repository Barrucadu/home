#!/bin/zsh

wd=`pwd`
mkdir -p ~/tmp/dvd/

pushd ~/tmp/dvd/

for file in $@; do
    # File paths relative to cwd
    [[ -f "$wd/$file" ]] && ffmpeg -i "$wd/$file" -target pal-dvd "track-$(basename "$file").mpg"
done

echo "<dvdauthor>" > dvd.xml
echo "<vmgm />" >> dvd.xml
echo "<titleset>" >> dvd.xml
echo "<titles>" >> dvd.xml
echo "<pgc>" >> dvd.xml

for file in $@; do
    [[ -f "track-$(basename "$file").mpg" ]] && echo "<vob file=\"track-$(basename "$file").mpg\" pause=\"5\"/>" >> dvd.xml
done

echo "</pgc>" >> dvd.xml
echo "</titles>" >> dvd.xml
echo "</titleset>" >> dvd.xml
echo "</dvdauthor>" >> dvd.xml

mkdir final
dvdauthor -o final -x dvd.xml

rm dvd.xml *.mpg

popd